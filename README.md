# bisect

How are programming errors distributed?

This repository contains scripts used for analysing repositories to determine how regressions are distributed between the release directly prior to the commit and the commit that fixes them.

It also contains the write-up of the analysis and results.

## Process

### 1. Collect data

```
Syntax: github-find <forks|updated> <language>

	Searches github for repositories containing the requested language
	bare clones them and analysis the history and diffs to discover
	regressions and their fixes.
	<forks|updated> : order based on number of forks or most recent update time.
	<language> : the language to search for.
```

For info about the ordering, see:
https://docs.github.com/en/search-github/searching-on-github/searching-for-repositories

These commands will output the following files
```
./results/index.json
./results/{language}/data{xxxxx}.json
```

Example usage:
```
./github-find.py forks c
```

### 2. Perform regression tests

TBD

### 3. Apply bisect to the raw results

```
Syntax: analyse <input-directory> <output-file>

	Reads in details of commits for different projects and applies the
	bisect algorithm to them.
	<input-directory> : a directory containing json commit files to perform the bisect algorithm on.
	<output-file> : a file to output the results to in json format.
```

This process performs the bisect algorithm using the based on the data output in json format by `github-find` to the `results/{language}` folder. By convention this is then stored in a file `./stats/{language}/{filename}.json`

In order to perform different analyses (for example: basic bisect algorithm; regression on commits bisect; regression on blocks bisect; etc.) it's currently necessary to edit the code.

In particular the function used to calculate the `weight` value should be changed. In some cases a preliminary step `compile_weights` is needed as an optimisation step

Example usage:
```
./analyse.py ./results/c ./stats/c/commits-regression.json
```

### 4. Perform uniformity tests
```
Syntax: statistics <input-directory> [bucket-min]

	Generate statistics for all json analysis files (generated by
	analysis.py) in a given directory.
	<input-directory> : the directory to read analysis json files from.
	[bucket-min]: minimum number of buckets to allow; defaults to 3.
```

Performs tests on the results from the bisect analysis, and the regression data. For example it will normalise the regression distance between the discovery and fix points and calculate the mean and standard deviation of the results.

It also performs a chi-squared test to determine whether the distribution of normalised fix distances is uniform.

```
./statistics.py stats/c
```

## Process summmary

Using C++ as an example, without the regression step:
```
./github-find.py forks c++
# Edit analyse.py to use `weight = weight_commits`
./analyse.py ./results/c++ ./stats/c++/commits.json
./statistics.py stats/c++
```
With the regression step:
```
# Edit analysis.py to use weight_commits_regression_exp
./analyse ./results/c++ ./stats/c++/commits-regression.json
./statistics.py stats/c++
```


## Notes

The following notes may be helpful in understanding how the results were generated. In many cases the python scripts for a repository can be performed at the console insteaad.

These steps are for illustrative purposes. They're not used in this form in the actual analysis.

### Find reverts
```
git log --format="%H" --grep "revert"
```

### Show commit for tag
```
git show --format="%H" 1.8.2 | head -1
git rev-list -n 1 1.8.2
```

### List latest tag before
```
git tag --contains dcda2c6 --sort=committerdate | head -1
git describe --tag dcda2c6
```

### List earliest tag after
```
git tag --no-contains dcda2c6 --sort=committerdate | tail -1
git describe --tag --contains dcda2c6
```

### Earliest commit
```
git rev-list --max-parents=0 HEAD
```

### Latest commit
```
# HEAD
```

### Commit revert refers to
```
$r = `git log --format="%b" $i | grep -o -E "[0-9a-f]{7}|[0-9a-f]{40}"`
```

Format <tag_before> <reverted> <reverting> <tag_after>

```
for i in `git log --format="%H" --grep "revert"`; do
	r=`git log --format="%b" -1 $i | grep -o -E "[0-9a-f]{7}|[0-9a-f]{40}"`
	if [ -n "$r" ]; then
		before=`git describe --tag --first-parent --abbrev=0 $r 2>/dev/null | cut -f1 -d"~"`
		after=`git describe --tag --first-parent --abbrev=0 --contains $r 2>/dev/null | cut -f1 -d"~"`
		below=`[ -z "$before" ] && echo \`git rev-list --max-parents=0 HEAD\` || echo $before`
		above=`[ -z "$after" ] && echo "HEAD" || echo $after`
		echo `git rev-list -n 1 $below` $r $i `git rev-list -n 1 $above`
	fi
done
```

Single line equivalent:
```
for i in `git log --format="%H" --grep "revert"`; do r=`git log --format="%b" -1 $i | grep -o -E "[0-9a-f]{7}|[0-9a-f]{40}"`; if [ -n "$r" ]; then before=`git describe --tag --first-parent --abbrev=0 $r 2>/dev/null | cut -f1 -d"~"`; after=`git describe --tag --first-parent --abbrev=0 --contains $r 2>/dev/null | cut -f1 -d"~"`; below=`[ -z "$before" ] && echo \`git rev-list --max-parents=0 HEAD\` || echo $before`; above=`[ -z "$after" ] && echo "HEAD" || echo $after`; echo `git rev-list -n 1 $below` $r $i `git rev-list -n 1 $above`; fi; done
```

### Build matplotlib on Sailfish OS

See:
https://github.com/nobodyinperson/matplotlib
https://openrepos.net/content/nobodyinperson/python3-matplotlib

libfreetype2 -> freetype

```
devel-su zypper install git gcc-c++ python3-devel freetype freetype-devel libpng-devel rpm-build
git clone git@github.com:nobodyinperson/matplotlib.git
cd matplotlib
python3 -m venv .
source bin/activate
pip install cython

python3 setup.py bdist_rpm
```


